

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>gooresmed &mdash; gooresmed 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="gooresmed 0.0.1 documentation" href="#"/>
        <link rel="next" title="gooresmed.download module" href="gooresmed.download.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="#" class="icon icon-home"> gooresmed
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="gooresmed.download.html">gooresmed.download module</a></li>
<li class="toctree-l1"><a class="reference internal" href="gooresmed.exceptions.html">gooresmed.exceptions module</a></li>
<li class="toctree-l1"><a class="reference internal" href="gooresmed.upload.html">gooresmed.upload module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">gooresmed</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li><code class="docutils literal"><span class="pre">gooresmed</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-gooresmed">
<span id="gooresmed"></span><h1><code class="docutils literal"><span class="pre">gooresmed</span></code><a class="headerlink" href="#module-gooresmed" title="Permalink to this headline">¶</a></h1>
<p>Utilities for Google Media Downloads and Resumable Uploads.</p>
<div class="section" id="authorized-transport">
<h2>Authorized Transport<a class="headerlink" href="#authorized-transport" title="Permalink to this headline">¶</a></h2>
<p>In order to download or upload a resource, an authorized transport
is required. For download requests, this must be an object that
supports <code class="docutils literal"><span class="pre">GET</span></code> requests via <code class="docutils literal"><span class="pre">transport.get(url,</span> <span class="pre">headers=headers)</span></code>.</p>
<p>For example, <code class="docutils literal"><span class="pre">google-auth</span></code> and <code class="docutils literal"><span class="pre">requests</span></code> can be used to
create an authorized transport that has read-only access to
Google Cloud Storage (GCS):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">google.auth</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">google.auth.transport.requests</span> <span class="k">as</span> <span class="nn">tr_requests</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ro_scope</span> <span class="o">=</span> <span class="s1">&#39;https://www.googleapis.com/auth/devstorage.read_only&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">credentials</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">scopes</span><span class="o">=</span><span class="p">(</span><span class="n">ro_scope</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transport</span> <span class="o">=</span> <span class="n">tr_requests</span><span class="o">.</span><span class="n">AuthorizedSession</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transport</span>
<span class="go">&lt;google.auth.transport.requests.AuthorizedSession object at 0x...&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-downloads">
<h2>Simple Downloads<a class="headerlink" href="#simple-downloads" title="Permalink to this headline">¶</a></h2>
<p>To download an object from Google Cloud Storage, construct the media URL
for the GCS object and download it with an authorized transport that has
access to the resource:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gooresmed</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_template</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&#39;https://www.googleapis.com/download/storage/v1/b/&#39;</span>
<span class="gp">... </span>    <span class="s1">&#39;</span><span class="si">{bucket}</span><span class="s1">/o/</span><span class="si">{blob_name}</span><span class="s1">?alt=media&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">media_url</span> <span class="o">=</span> <span class="n">url_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">blob_name</span><span class="o">=</span><span class="n">blob_name</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span> <span class="o">=</span> <span class="n">gooresmed</span><span class="o">.</span><span class="n">Download</span><span class="p">(</span><span class="n">media_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;1364156&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="go">1364156</span>
</pre></div>
</div>
<p>To download only a portion of the bytes in the object,
specify <code class="docutils literal"><span class="pre">start</span></code> and <code class="docutils literal"><span class="pre">end</span></code> byte positions (both optional):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">download</span> <span class="o">=</span> <span class="n">gooresmed</span><span class="o">.</span><span class="n">Download</span><span class="p">(</span><span class="n">media_url</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">8191</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [206]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;4096&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Range&#39;</span><span class="p">]</span>
<span class="go">&#39;bytes 4096-8191/1364156&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="go">4096</span>
</pre></div>
</div>
</div>
<div class="section" id="chunked-downloads">
<h2>Chunked Downloads<a class="headerlink" href="#chunked-downloads" title="Permalink to this headline">¶</a></h2>
<p>For very large objects or objects of unknown size, it may make more sense
to download the object in chunks rather than all at once. This can be done
to avoid dropped connections with a poor internet connection or can allow
multiple chunks to be downloaded in parallel to speed up the total
download.</p>
<p>Using the same media URL and authorized transport for a basic
<a class="reference internal" href="gooresmed.download.html#gooresmed.download.Download" title="gooresmed.download.Download"><code class="xref py py-class docutils literal"><span class="pre">Download</span></code></a>, a <a class="reference internal" href="gooresmed.download.html#gooresmed.download.ChunkedDownload" title="gooresmed.download.ChunkedDownload"><code class="xref py py-class docutils literal"><span class="pre">ChunkedDownload</span></code></a> also requires a chunk size:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 50MB</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span> <span class="o">=</span> <span class="n">gooresmed</span><span class="o">.</span><span class="n">ChunkedDownload</span><span class="p">(</span><span class="n">media_url</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check the state of the download before starting.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check the state of the download after consuming one chunk.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span>  <span class="c1"># chunk_size</span>
<span class="go">52428800</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span>  <span class="c1"># 1GB</span>
<span class="go">1073741824</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [206]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;52428800&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Range&#39;</span><span class="p">]</span>
<span class="go">&#39;bytes 0-52428799/1073741824&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="n">chunk_size</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The download will change it&#8217;s <code class="docutils literal"><span class="pre">finished</span></code> status to <a class="reference external" href="https://docs.python.org/3.6/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-data docutils literal"><span class="pre">True</span></code></a>
once the final chunk is consumed. In some cases, the final chunk may
not be the same size as the other chunks:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># The state of the download in progress.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span>  <span class="c1"># 20 chunks at 50MB</span>
<span class="go">1048576000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span>  <span class="c1"># 1GB</span>
<span class="go">1073741824</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The state of the download after consuming the final chunk.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span> <span class="o">==</span> <span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [206]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;25165824&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Range&#39;</span><span class="p">]</span>
<span class="go">&#39;bytes 1048576000-1073741823/1073741824&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">download</span><span class="o">.</span><span class="n">chunk_size</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In addition, a <a class="reference internal" href="gooresmed.download.html#gooresmed.download.ChunkedDownload" title="gooresmed.download.ChunkedDownload"><code class="xref py py-class docutils literal"><span class="pre">ChunkedDownload</span></code></a> can also take optional
<code class="docutils literal"><span class="pre">start</span></code> and <code class="docutils literal"><span class="pre">end</span></code> byte positions.</p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gooresmed.download.html" class="btn btn-neutral float-right" title="gooresmed.download module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Google.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>